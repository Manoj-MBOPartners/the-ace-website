<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Membership Form - The ACE</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
</head>
<body>
    <div id="root"></div>
    
    <script type="text/babel">
        const { useState, useRef, useEffect, useMemo } = React;

        function App() {
            const [data, setData] = useState({
                applicantTitle: "Shri",
                applicantName: "",
                age: "",
                occupation: "",
                flatNo: "",
                block: "",
                areaSqft: "",
                buildingName: "The ACE",
                addressLine: "1, Corporation Road, Chennai",
                owners: [{ name: "", details: "", location: "", memberInJoint: "Yes" }],
                admissionFee: "1000",
                place: "",
                date: new Date().toISOString().slice(0, 10),
                mobile: "",
                email: "",
                jointUndertaking: "",
                typedSignature: "",
                signatureDataUrl: "",
            });

            const [showAssociationSignBox, setShowAssociationSignBox] = useState(false);
            const photoInputRef = useRef(null);
            const [photoUrl, setPhotoUrl] = useState("");

            const canvasRef = useRef(null);
            const isDrawingRef = useRef(false);
            const lastPointRef = useRef({ x: 0, y: 0 });

            function update(key, value) {
                setData((d) => {
                    const newData = { ...d, [key]: value };
                    
                    // Auto-update owner fields when block, flatNo, or areaSqft changes
                    if (['block', 'flatNo', 'areaSqft'].includes(key)) {
                        newData.owners = newData.owners.map(owner => ({
                            ...owner,
                            details: `${newData.areaSqft ? newData.areaSqft + ' sq ft' : ''}${newData.block ? ' • Block ' + newData.block : ''}`.trim(),
                            location: `${newData.block ? newData.block : ''} ${newData.flatNo}`.trim()
                        }));
                    }
                    
                    return newData;
                });
            }

            function setOwner(idx, key, value) {
                setData((d) => {
                    const owners = d.owners.slice();
                    owners[idx] = { ...owners[idx], [key]: value };
                    return { ...d, owners };
                });
            }

            function addOwnerRow() {
                setData((d) => ({ ...d, owners: [...d.owners, { name: "", details: "", location: "", memberInJoint: "Yes" }] }));
            }

            function removeOwnerRow(i) {
                setData((d) => ({ ...d, owners: d.owners.filter((_, idx) => idx !== i) }));
            }

            function autoFillOwnerFields() {
                setData((d) => {
                    const owners = d.owners.map(owner => ({
                        ...owner,
                        details: `${d.areaSqft ? d.areaSqft + ' sq ft' : ''}${d.block ? ' • Block ' + d.block : ''}`.trim(),
                        location: `${d.block ? d.block : ''} ${d.flatNo}`.trim()
                    }));
                    return { ...d, owners };
                });
            }

            function onSelectPhoto(e) {
                const file = e.target.files && e.target.files[0];
                if (!file) return;
                const url = URL.createObjectURL(file);
                setPhotoUrl(url);
            }

            function handlePrint() {
                window.print();
            }

              function getCanvasPoint(evt) {
    const canvas = canvasRef.current;
    const rect = canvas.getBoundingClientRect();
    
    // Get the canvas scaling factor (CSS size vs actual canvas size)
    const scaleX = canvas.width / rect.width;
    const scaleY = canvas.height / rect.height;
    
    // Calculate mouse position relative to canvas
    const clientX = evt.clientX ?? (evt.touches && evt.touches[0]?.clientX);
    const clientY = evt.clientY ?? (evt.touches && evt.touches[0]?.clientY);
    
    const cx = (clientX - rect.left) * scaleX;
    const cy = (clientY - rect.top) * scaleY;
    
    return { x: cx, y: cy };
  }
            
            function startDraw(evt) {
                if (!canvasRef.current) return;
                isDrawingRef.current = true;
                const p = getCanvasPoint(evt);
                lastPointRef.current = p;
            }
            
              function moveDraw(evt) {
    if (!isDrawingRef.current || !canvasRef.current) return;
    evt.preventDefault();
    const ctx = canvasRef.current.getContext("2d");
    ctx.lineWidth = 2;
    ctx.lineCap = "round";
    ctx.lineJoin = "round";
    ctx.strokeStyle = "#111";
    const p = getCanvasPoint(evt);
    ctx.beginPath();
    ctx.moveTo(lastPointRef.current.x, lastPointRef.current.y);
    ctx.lineTo(p.x, p.y);
    ctx.stroke();
    lastPointRef.current = p;
  }
            
            function endDraw() {
                if (!canvasRef.current) return;
                isDrawingRef.current = false;
                const url = canvasRef.current.toDataURL("image/png");
                update("signatureDataUrl", url);
            }
            
            function clearSignature() {
                if (!canvasRef.current) return;
                const ctx = canvasRef.current.getContext("2d");
                ctx.clearRect(0, 0, canvasRef.current.width, canvasRef.current.height);
                update("signatureDataUrl", "");
            }

            const [testResults, setTestResults] = useState([]);
            useEffect(() => {
                const results = [];
                results.push({ name: "Print button exists", pass: !!document.querySelector('[data-testid="print-button"]') });
                results.push({ name: "Printable container exists", pass: !!document.querySelector('#printable') });
                results.push({ name: "Applicant signature area visible", pass: !!document.querySelector('[data-testid="signature-applicant"]') });
                const assocVisible = !!document.querySelector('[data-testid="signature-association"]');
                results.push({ name: "Association signature default hidden", pass: !assocVisible });
                setTestResults(results);
            }, []);

            // Auto-populate owner fields when main form data changes
            useEffect(() => {
                if (data.block || data.flatNo || data.areaSqft) {
                    setData((d) => ({
                        ...d,
                        owners: d.owners.map(owner => ({
                            ...owner,
                            details: `${d.areaSqft ? d.areaSqft + ' sq ft' : ''}`.trim(),
                            location: `${d.block ? d.block : ''} ${d.flatNo}`.trim()
                        }))
                    }));
                }
            }, [data.block, data.flatNo, data.areaSqft]);

            return (
                <div className="min-h-screen w-full bg-neutral-100 text-neutral-900">
                    {/* Header */}
                    <div className="print:hidden sticky top-0 z-10 border-b bg-white/90 backdrop-blur">
                        <div className="mx-auto max-w-6xl px-4 py-3 flex flex-wrap items-center gap-2 justify-between">
                            <div className="flex items-center gap-4">
                                <img src="/public/taaowa-logo.jpeg" alt="THE ACE Logo" className="h-12 w-12 object-contain" />
                                <div>
                                    <h1 className="text-xl font-semibold tracking-tight">THE ACE APARTMENT OWNERS WELFARE ASSOCIATION</h1>
                                    <p className="text-sm text-gray-600">(Reg. No.Chennai South/175/2025. Under TN Apartment Ownership Act 2022)</p>
                                </div>
                            </div>
                            <div className="flex gap-2">
                                <a href="https://www.aceapartment.org/" className="rounded-2xl px-4 py-2 bg-gray-600 text-white shadow hover:shadow-md active:scale-[.99]">← Back to Home</a>
                                <button data-testid="print-button" onClick={handlePrint} className="rounded-2xl px-4 py-2 bg-black text-white shadow hover:shadow-md active:scale-[.99]">Print filled form</button>
                            </div>
                        </div>
                    </div>

                    {/* Main layout */}
                    <div className="mx-auto max-w-6xl grid lg:grid-cols-2 gap-6 p-4">
                        {/* Form column */}
                        <section className="print:hidden">
                            <div className="rounded-2xl bg-white p-4 shadow-sm">
                                <h2 className="text-lg font-semibold">Applicant details</h2>
                                <div className="mt-3 grid grid-cols-1 md:grid-cols-3 gap-3">
                                    <div>
                                        <label className="text-sm font-medium">Title</label>
                                        <select value={data.applicantTitle} onChange={(e) => update("applicantTitle", e.target.value)} className="mt-1 w-full rounded-xl border p-2">
                                            <option>Mr</option>
                                            <option>Mrs</option>
                                            <option>Ms</option>
                                        </select>
                                    </div>
                                    <div className="md:col-span-2">
                                        <label className="text-sm font-medium">Full name</label>
                                        <input value={data.applicantName} onChange={(e) => update("applicantName", e.target.value)} className="mt-1 w-full rounded-xl border p-2" placeholder="Your name" />
                                    </div>
                                    <div>
                                        <label className="text-sm font-medium">Age</label>
                                        <input value={data.age} onChange={(e) => update("age", e.target.value)} className="mt-1 w-full rounded-xl border p-2" placeholder="Years" />
                                    </div>
                                    <div className="md:col-span-2">
                                        <label className="text-sm font-medium">Occupation</label>
                                        <input value={data.occupation} onChange={(e) => update("occupation", e.target.value)} className="mt-1 w-full rounded-xl border p-2" placeholder="e.g., Engineer" />
                                    </div>
                                </div>

                                <div className="mt-6 grid grid-cols-1 md:grid-cols-3 gap-3">
                                    <div>
                                        <label className="text-sm font-medium">Block</label>
                                        <select value={data.block} onChange={(e) => update("block", e.target.value)} className="mt-1 w-full rounded-xl border p-2">
                                            <option value="">Select Block</option>
                                            <option value="A">A</option>
                                            <option value="B">B</option>
                                            <option value="C">C</option>
                                            <option value="D">D</option>
                                        </select>
                                    </div>
                                    <div>
                                        <label className="text-sm font-medium">Flat No</label>
                                        <input 
                                            value={data.flatNo} 
                                            onChange={(e) => {
                                                const value = e.target.value;
                                                // Only allow numeric input
                                                if (/^\d*$/.test(value)) {
                                                    // Validate the format
                                                    if (value.length <= 4) {
                                                        update("flatNo", value);
                                                    }
                                                }
                                            }}
                                            onBlur={(e) => {
                                                const value = e.target.value;
                                                if (value.length >= 3 && value.length <= 4) {
                                                    const firstTwo = parseInt(value.substring(0, 2));
                                                    const lastTwo = parseInt(value.substring(value.length - 2));
                                                    
                                                    if (firstTwo < 1 || firstTwo > 19 || lastTwo < 1 || lastTwo > 8) {
                                                        // Highlight input in red instead of showing alert
                                                        e.target.style.borderColor = '#ef4444';
                                                        e.target.style.backgroundColor = '#fef2f2';
                                                        e.target.style.color = '#dc2626';
                                                    } else {
                                                        // Reset to normal styling if valid
                                                        e.target.style.borderColor = '';
                                                        e.target.style.backgroundColor = '';
                                                        e.target.style.color = '';
                                                    }
                                                }
                                            }}
                                            onFocus={(e) => {
                                                // Reset styling when user focuses on the field
                                                e.target.style.borderColor = '';
                                                e.target.style.backgroundColor = '';
                                                e.target.style.color = '';
                                            }}
                                            className="mt-1 w-full rounded-xl border p-2 transition-colors duration-200" 
                                            placeholder="e.g., 1201 (3-4 digits)" 
                                            pattern="[0-9]{3,4}"
                                            title="Enter 3-4 digits. First 2 digits: 1-19, Last 2 digits: 01-08"
                                        />
                                        <div className="text-xs text-gray-500 mt-1">
                                            Format: 3-4 digits. First 2 digits (1-19), Last 2 digits (01-08)
                                        </div>
                                    </div>
                                    <div>
                                        <label className="text-sm font-medium">Area (sq ft)</label>
                                        <input value={data.areaSqft} onChange={(e) => update("areaSqft", e.target.value)} className="mt-1 w-full rounded-xl border p-2" placeholder="e.g., 1222" />
                                    </div>
                                </div>

                                <div className="mt-6 grid grid-cols-1 md:grid-cols-2 gap-3">
                                                  <div>
                <label className="text-sm font-medium">Mobile</label>
                <input 
                    value={data.mobile} 
                    onChange={(e) => {
                        const value = e.target.value;
                        if (/^\d*$/.test(value)) {
                            update("mobile", value);
                        }
                    }}
                    className="mt-1 w-full rounded-xl border p-2" 
                    placeholder="10-digit number" 
                    inputMode="numeric"
                    pattern="[0-9]*"
                />
              </div>
                                    <div>
                                        <label className="text-sm font-medium">Email</label>
                                        <input value={data.email} onChange={(e) => update("email", e.target.value)} className="mt-1 w-full rounded-xl border p-2" placeholder="you@example.com" />
                                    </div>
                                </div>



                                            <div className="mt-6">
                <div className="flex items-center justify-between">
                    <h3 className="font-semibold">Owners / Joint ownership</h3>
                    <div className="flex gap-2">
                        <button onClick={addOwnerRow} className="rounded-xl border px-3 py-1 text-sm hover:bg-neutral-50">Add row</button>
                    </div>
                </div>
                                    <div className="mt-2 overflow-x-auto">
                                        <table className="w-full text-sm">
                                            <thead>
                                                <tr className="text-left">
                                                    <th className="pb-2 pr-2">Name</th>
                                                    <th className="pb-2 pr-2">Joint owner as per Sale agreement</th>
                                                    <th className="pb-2"></th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                {data.owners.map((o, i) => (
                                                    <tr key={i} className="align-top">
                                                        <td className="pb-2 pr-2">
                                                            <input className="w-full rounded-lg border p-2" value={o.name} onChange={(e) => setOwner(i, "name", e.target.value)} />
                                                        </td>
                                                        <td className="pb-2 pr-2">
                                                            <select value={o.memberInJoint || "Yes"} onChange={(e) => setOwner(i, "memberInJoint", e.target.value)} className="w-full rounded-lg border p-2">
                                                                <option value="Yes">Yes</option>
                                                                <option value="No">No</option>
                                                            </select>
                                                        </td>
                                                        <td className="pb-2">
                                                            {data.owners.length > 1 && (
                                                                <button onClick={() => removeOwnerRow(i)} className="rounded-lg border px-2 py-1 text-xs hover:bg-neutral-50">Remove</button>
                                                            )}
                                                        </td>
                                                    </tr>
                                                ))}
                                            </tbody>
                                        </table>
                                    </div>
                                </div>

                                <div className="mt-6 grid grid-cols-1 md:grid-cols-2 gap-3">
                                    <div>
                                        <label className="text-sm font-medium">Admission fee (₹)</label>
                                        <div className="mt-1 w-full rounded-xl border p-2 bg-gray-50 text-gray-700">
                                            ₹{data.admissionFee}
                                        </div>
                                    </div>
                                    <div>
                                        <label className="text-sm font-medium">Date</label>
                                        <input type="date" value={data.date} onChange={(e) => update("date", e.target.value)} className="mt-1 w-full rounded-xl border p-2" />
                                    </div>
                                </div>

                                <div className="mt-6">
                                    <label className="text-sm font-medium">Upload photo <span className="text-red-500">*</span></label>
                                    <input ref={photoInputRef} type="file" accept="image/*" onChange={onSelectPhoto} required className="mt-1 block w-full text-sm" />
                                    <div className="text-xs text-red-500 mt-1">Photo is required for membership application</div>
                                </div>

                                {/* Signature input (draw or type) */}
                                            <div className="mt-8">
              <h3 className="font-semibold mb-2">Signature (input box)</h3>
              <div className="space-y-4">
                {/* Drawn signature - full width */}
                <div>
                  <div className="text-sm mb-1">Draw your signature</div>
                  <div className="border rounded-xl p-3">
                    <canvas
                      ref={canvasRef}
                      width={800}
                      height={120}
                      className="w-full h-40 bg-white rounded-lg border"
                      style={{ aspectRatio: '800/120' }}
                      onMouseDown={startDraw}
                      onMouseMove={moveDraw}
                      onMouseUp={endDraw}
                      onMouseLeave={endDraw}
                      onTouchStart={startDraw}
                      onTouchMove={moveDraw}
                      onTouchEnd={endDraw}
                    />
                    <div className="mt-2 flex gap-2">
                      <button type="button" onClick={clearSignature} className="rounded-lg border px-3 py-1 text-sm">Clear</button>
                      <span className="text-xs text-neutral-600 self-center">Saved automatically to preview</span>
                    </div>
                  </div>
                </div>
                {/* Typed signature - full width */}
                <div>
                  <div className="text-sm mb-1">Type applicant's name</div>
                  <input
                    value={data.typedSignature}
                    onChange={(e) => update("typedSignature", e.target.value)}
                    placeholder="Type full name as signature"
                    className="w-full rounded-xl border p-2"
                  />
                  <div className="mt-2 text-xs text-neutral-600">If both drawn and typed are provided, the <span className="font-medium">drawn</span> signature will be used in the print.</div>
                </div>
              </div>
            </div>

                                <div className="mt-6 flex gap-3">
                                    <button data-testid="print-button" onClick={handlePrint} className="rounded-2xl px-4 py-2 bg-black text-white shadow hover:shadow-md active:scale-[.99]">Print filled form</button>
                                    <p className="text-sm text-neutral-600 self-center">This opens your browser's print dialog (choose a printer or "Save as PDF").</p>
                                </div>

                            </div>
                        </section>

                        {/* Preview/Printable column */}
                        <section>
                            <div id="printable" className="rounded-2xl bg-white p-6 shadow-sm print:shadow-none print:rounded-none">
                                <PrintableView data={data} photoUrl={photoUrl} showAssociationSignBox={showAssociationSignBox} />
                            </div>
                        </section>
                    </div>

                    <style>{`
                        @page { 
                            size: A4; 
                            margin: 16mm;
                            @top-center { content: ""; }
                            @top-left { content: ""; }
                            @top-right { content: ""; }
                            @bottom-center { content: ""; }
                            @bottom-left { content: ""; }
                            @bottom-right { content: ""; }
                        }
                        @media print {
                            body { background: white; }
                            .print\\:hidden { display: none !important; }
                            #printable { box-shadow: none !important; }
                            @page { 
                                margin-top: 0;
                                margin-bottom: 0;
                            }
                        }
                    `}</style>
                </div>
            );
        }

        function FieldRow({ label, children }) {
            return (
                <div className="grid grid-cols-12 gap-2 items-start">
                    <div className="col-span-4 md:col-span-3 text-sm font-medium text-neutral-700">{label}</div>
                    <div className="col-span-8 md:col-span-9">{children}</div>
                </div>
            );
        }

        function LineBox({ children }) {
            return <div className="min-h-8 border-b border-dashed pb-1">{children}</div>;
        }

        const PrintableView = React.memo(function PrintableView({ data, photoUrl, showAssociationSignBox }) {
            const today = useMemo(() => new Date().toLocaleDateString(), []);
            const hasDrawnSignature = !!data.signatureDataUrl;
            const hasTypedSignature = !!data.typedSignature?.trim();
            

            
            return (
                <div className="space-y-5">
                    {/* Association Header */}
                    <div className="text-center border-b pb-4">
                        <div className="flex items-center justify-center gap-4 mb-3">
                            <img src="/public/taaowa-logo.jpeg" alt="THE ACE Logo" className="h-16 w-16 object-contain" />
                        </div>
                        <h1 className="text-2xl font-bold text-gray-800">THE ACE APARTMENT OWNERS WELFARE ASSOCIATION</h1>
                        <p className="text-sm text-gray-600 mt-1">(Reg. No.Chennai South/175/2025. Under TN Apartment Ownership Act 2022)</p>
                    </div>



                    {/* Address / To */}
                    <div>
                        <div>To,</div>
                        <div className="font-medium">The President / Secretary</div>
                        <div>{data.buildingName} Apartment Owners Welfare Association</div>
                        <div>{data.addressLine}</div>
                    </div>

                    {/* Salutation paragraph */}
                    <div className="text-sm leading-6">
                        I, {data.applicantTitle} <span className="font-medium">{data.applicantName || "__________"}</span> hereby make an application for membership of the {data.buildingName} Apartment Owners Welfare Association. <br/> <br/>My particulars for the purpose of consideration of this application are as under:
                    </div>

                    {/* Photo + quick lines */}
                    <div className="grid grid-cols-12 gap-4">
                        <div className="col-span-9 space-y-3">
                            <FieldRow label="Age">
                                <LineBox>{data.age}</LineBox>
                            </FieldRow>
                            <FieldRow label="Occupation">
                                <LineBox>{data.occupation}</LineBox>
                            </FieldRow>
                            <FieldRow label="Flat No / Block">
                                <LineBox>
                                    {data.block && ` ${data.block}`} {data.flatNo}
                                </LineBox>
                            </FieldRow>
                            <FieldRow label="Area">
                                <LineBox>
                                    {data.areaSqft && `${data.areaSqft} sq ft`}
                                </LineBox>
                            </FieldRow>
                        </div>
                        <div className="col-span-3">
                            <div className="aspect-[3/4] border flex items-center justify-center text-xs text-neutral-500">
                                {photoUrl ? <img src={photoUrl} alt="Applicant" className="h-full w-full object-cover" /> : "Photo"}
                            </div>
                        </div>
                    </div>

                    {/* Owners table */}
                    <div>
                        <div className="font-semibold">Joint ownership details</div>
                        <table className="mt-2 w-full text-sm">
                            <thead>
                                <tr className="border-b">
                                    <th className="text-left py-1 pr-2">Sr. No.</th>
                                    <th className="text-left py-1 pr-2">Name of person(s)</th>
                                    <th className="text-left py-1 pr-2">Flat particulars</th>
                                    <th className="text-left py-1 pr-2">Location</th>
                                    <th className="text-left py-1">Joint owner as per Sale agreement</th>
                                </tr>
                            </thead>
                            <tbody>
                                {data.owners
                                    .filter(owner => owner.name && owner.name.trim().length > 0)
                                    .map((o, i) => (
                                        <tr key={i} className="border-b last:border-b-0 align-top">
                                            <td className="py-1 pr-2">{i + 1}</td>
                                            <td className="py-1 pr-2">{o.name}</td>
                                            <td className="py-1 pr-2">{o.details}</td>
                                            <td className="py-1 pr-2">{o.location}</td>
                                            <td className="py-1">{o.memberInJoint || 'Yes'}</td>
                                        </tr>
                                    ))}
                            </tbody>
                        </table>
                    </div>

                    {/* Declarations */}
                    <div className="space-y-2 text-sm leading-6">
                        <p>
                            I remit herewith a sum of ₹ {data.admissionFee || "_____"} (excluding tax) for admission entrance fee to the Association. I undertake to discharge all the present and future liabilities to the Association.
                        </p>
                        <p>
                            I undertake to use the flat for the purpose for which it is purchased by me/us and that any change of use like renting it out will be made with intimation to the Association. I agree that the rules of the Association will be followed by me.
                        </p>
                        <p>
                            I have gone through the registered Bye-law of the Association and undertake to abide by the same and any modifications from time to time.
                        </p>
                        <p>
                            I declare that the said acquiring of flat is duly registered under Tamilnadu registration rules and relevant stamp duty paid.
                        </p>
                        <p>
                            Joint owner as per Sale agreement: <span className="font-medium">
                                {(() => {
                                    const validOwners = data.owners.filter(owner => owner.name && owner.name.trim().length > 0);
                                    
                                    if (validOwners.length === 0) {
                                        return 'Not specified';
                                    }
                                    
                                    return validOwners.map((owner, index) => (
                                        <span key={index}>
                                            {owner.name}: {owner.memberInJoint || 'Yes'}
                                            {index < validOwners.length - 1 && ', '}
                                        </span>
                                    ));
                                })()}
                            </span>
                        </p>
                    </div>

                    {/* Place */}
                    <div className="grid grid-cols-12 gap-4 mt-2">
                        <div className="col-span-6">
                            <FieldRow label="Place">
                                <LineBox>{data.place}</LineBox>
                            </FieldRow>
                        </div>
                    </div>

                    <div className="grid grid-cols-12 gap-4 mt-4">
                        <div className="col-span-6">
                            <FieldRow label="Mobile">
                                <LineBox>{data.mobile}</LineBox>
                            </FieldRow>
                        </div>
                        <div className="col-span-6">
                            <FieldRow label="Email">
                                <LineBox>{data.email}</LineBox>
                            </FieldRow>
                        </div>
                    </div>

                    {/* Signature Boxes */}
                    <div className="grid grid-cols-12 gap-4 mt-12">
                        <div className="col-span-6 flex justify-start" data-testid="signature-applicant">
                            <div className="w-80 text-center">
                                {/* Signature rendering preference: drawn > typed > empty line */}
                                <div className="h-20 flex items-center justify-center border-b border-neutral-800">
                                    {hasDrawnSignature ? (
                                        <img 
                                            src={data.signatureDataUrl} 
                                            alt="Signature" 
                                            className="max-h-16 max-w-full object-contain" 
                                            style={{ width: 'auto', height: 'auto' }}
                                        />
                                    ) : hasTypedSignature ? (
                                        <span style={{ fontFamily: 'cursive', fontSize: '1.1rem' }}>{data.typedSignature}</span>
                                    ) : null}
                                </div>
                                <div className="text-sm mt-1">(Signature of the Applicant)</div>
                                {(hasDrawnSignature || hasTypedSignature) && data.typedSignature && (
                                    <div className="text-sm mt-1 font-medium">{data.typedSignature}</div>
                                )}

                            </div>
                        </div>
                        {showAssociationSignBox && (
                            <div className="col-span-6 flex justify-end" data-testid="signature-association">
                                <div className="w-56 text-center">
                                    <div className="h-20 border-b border-neutral-800"></div>
                                    <div className="text-sm mt-1">(Signature with Seal – Association Official)</div>
                                </div>
                            </div>
                        )}
                    </div>

                    <div className="text-sm text-neutral-600 mt-6">(For Office use) Membership No. ____________ • Receipt No. ____________</div>

                    {/* Optional Undertaking */}
                    {data.jointUndertaking && data.jointUndertaking.trim() && (
                        <div className="mt-8 border-t pt-4">
                            <div className="text-center text-xs">[Under the Bye-law No. 9(f)]</div>
                            <div className="text-center font-semibold">Undertaking (Joint Ownership)</div>
                            <div className="whitespace-pre-wrap text-sm mt-2 leading-6">{data.jointUndertaking}</div>
                        </div>
                    )}

                </div>
            );
        });

        // Render the app
        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html> 